graph TB
    subgraph Browser["ğŸ–¥ï¸ User Browser (React 19 + TypeScript)"]
        FE["Frontend<br/>React 19 + TypeScript<br/>Vite 7"]
        AUTH["ğŸ” Firebase Anonymous Auth<br/>Persistent UID<br/>Zero-Friction"]
    end

    subgraph CloudRun["â˜ï¸ Google Cloud Run"]
        API["FastAPI Backend<br/>Port 8080<br/>REST + SSE Streaming"]

        subgraph Pipeline["ADK Sequential Pipeline"]
            BA["ğŸ” Brand Analyst Agent<br/>URL Scraping + Brand DNA<br/>Colors, Tone, Audience<br/>Temperature 0.15"]
            STR["ğŸ“… Strategy Agent<br/>7-Day Content Calendar<br/>Pillar-Based Planning<br/>Event Integration"]
            CC["âœ¨ Content Creator Agent<br/>Gemini Interleaved Output<br/>Text + Image Together<br/>Carousel: 3-Slide Parallel Gen"]
            RA["ğŸ” Review Agent<br/>Brand Alignment Check<br/>Revised Captions + Hashtags<br/>Auto-Clean Stopwords"]
        end

        subgraph Support["Supporting Agents"]
            VC["ğŸ—£ï¸ Voice Coach<br/>Gemini Live API<br/>BidiGenerateContent<br/>Multi-Turn Sessions"]
            VID["ğŸ¬ Video Creator<br/>Veo 3.1<br/>Reels / TikTok Clips"]
        end

        subgraph Services["Backend Services"]
            WS["ğŸŒ Web Scraper<br/>httpx + BeautifulSoup"]
            BT["ğŸ·ï¸ Brand Tools<br/>ADK Tool Wrappers"]
            HS["ğŸ§¹ Hashtag Sanitizer<br/>Stopword Filter<br/>Per-Platform Limits"]
            EX["ğŸ“¦ Export Service<br/>ZIP: Image + Video + Caption<br/>Direct GCS Download"]
            IF["ğŸ–¼ï¸ Image Fallback<br/>Separate Image-Only Gen<br/>On Interleaved Failure"]
        end
    end

    subgraph GCP["Google Cloud Platform"]
        FS[("ğŸ”¥ Cloud Firestore<br/>Brand Profiles (owner_uid)<br/>Content Plans + Posts<br/>Video Jobs")]
        GCS[("ğŸ“¦ Cloud Storage<br/>Generated Images<br/>Generated Videos<br/>Uploaded Assets")]
        FA["ğŸ” Firebase Auth<br/>Anonymous Auth Provider<br/>Persistent UIDs"]
    end

    subgraph Gemini["Google Gemini API"]
        GFlash["gemini-2.5-flash<br/>generateContent<br/>responseModalities:<br/>TEXT + IMAGE"]
        GLive["Gemini Live API<br/>BidiGenerateContent<br/>Multi-Turn Voice"]
    end

    FE <-->|"REST + SSE<br/>/api/*"| API
    AUTH <-->|"Anonymous UID"| FA

    API --> BA
    BA --> STR
    STR --> CC
    CC --> RA

    API --> VC
    API --> VID

    BA --> WS
    BA --> BT
    CC --> HS
    CC --> IF
    RA --> HS
    API --> EX

    BA -->|"Brand Analysis<br/>(temp 0.15)"| GFlash
    STR -->|"Strategy Planning"| GFlash
    CC -->|"Interleaved<br/>Text + Image"| GFlash
    IF -->|"Image-Only<br/>Fallback"| GFlash
    RA -->|"Review + Revise"| GFlash
    VC -->|"Voice Sessions"| GLive

    API --> FS
    API --> GCS
    CC -->|"Store Images"| GCS
    VID -->|"Store Video"| GCS
    EX -->|"Download Media<br/>blob.download_as_bytes"| GCS

    classDef browser fill:#1a1a2e,stroke:#e94560,color:#fff
    classDef cloud fill:#0f3460,stroke:#16213e,color:#fff
    classDef pipeline fill:#533483,stroke:#e94560,color:#fff
    classDef support fill:#2d4059,stroke:#ea5455,color:#fff
    classDef tools fill:#3c4043,stroke:#8ab4f8,color:#fff
    classDef gcp fill:#4285f4,stroke:#1a73e8,color:#fff
    classDef gemini fill:#1e88e5,stroke:#1565c0,color:#fff
    classDef auth fill:#ff9800,stroke:#f57c00,color:#fff

    class FE browser
    class AUTH auth
    class API cloud
    class BA,STR,CC,RA pipeline
    class VC,VID support
    class WS,BT,HS,EX,IF tools
    class FS,GCS,FA gcp
    class GFlash,GLive gemini
